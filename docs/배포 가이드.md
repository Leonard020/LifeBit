# LifeBit ìë™í™” ë°°í¬ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” LifeBit í”„ë¡œì íŠ¸ì˜ AWS ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ê¸°ë°˜ ìë™í™” ë°°í¬ë¥¼ ìœ„í•œ ìƒì„¸í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ì‚¬ì „ ìš”êµ¬ì‚¬í•­](#ì‚¬ì „-ìš”êµ¬ì‚¬í•­)
2. [í™˜ê²½ ì„¤ì •](#í™˜ê²½-ì„¤ì •)
3. [ë°°í¬ í”„ë¡œì„¸ìŠ¤](#ë°°í¬-í”„ë¡œì„¸ìŠ¤)
4. [ëª¨ë‹ˆí„°ë§ ë° ìœ ì§€ë³´ìˆ˜](#ëª¨ë‹ˆí„°ë§-ë°-ìœ ì§€ë³´ìˆ˜)
5. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
6. [ë¹„ìš© ìµœì í™”](#ë¹„ìš©-ìµœì í™”)

## ğŸ”§ ì‚¬ì „ ìš”êµ¬ì‚¬í•­

### 1. AWS ê³„ì • ë° ê¶Œí•œ

#### AWS ê³„ì • ìƒì„±
- AWS ê³„ì •ì´ í•„ìš”í•©ë‹ˆë‹¤ (í•™ì› í”„ë¡œì íŠ¸ìš© ë¬´ë£Œ í‹°ì–´ ê¶Œì¥)
- IAM ì‚¬ìš©ì ìƒì„± ë° ê¶Œí•œ ì„¤ì •

#### í•„ìš”í•œ ê¶Œí•œ
```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "ec2:*",
                "s3:*",
                "route53:*",
                "iam:GetUser",
                "iam:ListAccessKeys"
            ],
            "Resource": "*"
        }
    ]
}
```

#### AWS CLI ì„¤ì •
```bash
# AWS CLI ì„¤ì¹˜
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
unzip awscliv2.zip
sudo ./aws/install

# AWS ì„¤ì •
aws configure
```

### 2. ë„êµ¬ ì„¤ì¹˜

#### Terraform ì„¤ì¹˜
```bash
# Terraform ì„¤ì¹˜
curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -
sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"
sudo apt-get update && sudo apt-get install terraform

# ë²„ì „ í™•ì¸
terraform version
```

#### Ansible ì„¤ì¹˜
```bash
# Ansible ì„¤ì¹˜
sudo apt-get update
sudo apt-get install software-properties-common
sudo apt-add-repository --yes --update ppa:ansible/ansible
sudo apt-get install ansible

# ë²„ì „ í™•ì¸
ansible --version
```

#### Docker ì„¤ì¹˜ (ë¡œì»¬ ê°œë°œìš©)
```bash
# Docker ì„¤ì¹˜
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Docker Compose ì„¤ì¹˜
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

### 3. SSH í‚¤í˜ì–´ ìƒì„±

```bash
# SSH í‚¤í˜ì–´ ìƒì„±
ssh-keygen -t rsa -b 4096 -f ~/.ssh/lifebit-key -N ""

# AWSì— í‚¤í˜ì–´ ë“±ë¡
aws ec2 import-key-pair \
    --key-name lifebit-key \
    --public-key-material fileb://~/.ssh/lifebit-key.pub
```

## ğŸŒ í™˜ê²½ ì„¤ì •

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì„¤ì •í•©ë‹ˆë‹¤:

```bash
# AWS ì„¤ì •
export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_REGION="ap-northeast-2"

# ì„œë²„ ì„¤ì •
export LIFEBIT_SERVER_IP="your-server-ip"  # ë°°í¬ í›„ ì„¤ì •
export AWS_KEY_NAME="lifebit-key"

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
export DB_PASSWORD="your-secure-password"
export DB_NAME="lifebit_db"
export DB_USER="lifebit_user"

# OpenAI ì„¤ì •
export OPENAI_API_KEY="your-openai-api-key"

# ì†Œì…œ ë¡œê·¸ì¸ ì„¤ì •
export KAKAO_CLIENT_ID="your-kakao-client-id"
export GOOGLE_CLIENT_ID="your-google-client-id"

# ë„ë©”ì¸ ì„¤ì • (ì„ íƒì‚¬í•­)
export DOMAIN_NAME="your-domain.com"

# JWT ì„¤ì •
export JWT_SECRET="your-jwt-secret-key"
```

### 2. Terraform ë³€ìˆ˜ ì„¤ì •

`infrastructure/terraform/terraform.tfvars` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤:

```hcl
# AWS ì„¤ì •
aws_region = "ap-northeast-2"
instance_type = "t3.medium"
key_name = "lifebit-key"
volume_size = 20

# ë„ë©”ì¸ ì„¤ì • (ì„ íƒì‚¬í•­)
domain_name = "your-domain.com"
create_domain = false

# í™˜ê²½ ì„¤ì •
environment = "production"
project_name = "LifeBit"
```

## ğŸš€ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### 1ë‹¨ê³„: ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹

```bash
# ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./infrastructure/scripts/deploy.sh

# ë˜ëŠ” ë‹¨ê³„ë³„ ì‹¤í–‰
./infrastructure/scripts/deploy.sh terraform-only
```

#### Terraform ì‹¤í–‰ ê³¼ì •
1. **ì´ˆê¸°í™”**: `terraform init`
2. **ê³„íš í™•ì¸**: `terraform plan`
3. **ì‚¬ìš©ì í™•ì¸**: ê³„ì† ì§„í–‰ ì—¬ë¶€ í™•ì¸
4. **ì¸í”„ë¼ ìƒì„±**: `terraform apply`

#### ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤
- VPC ë° ì„œë¸Œë„·
- ë³´ì•ˆ ê·¸ë£¹
- EC2 ì¸ìŠ¤í„´ìŠ¤ (t3.medium)
- Elastic IP
- S3 ë²„í‚· (Terraform ìƒíƒœ ì €ì¥ìš©)

### 2ë‹¨ê³„: ì„œë²„ ì„¤ì •

```bash
# Ansible ë°°í¬
./infrastructure/scripts/deploy.sh ansible-only
```

#### Ansible ì‹¤í–‰ ê³¼ì •
1. **ì—°ê²° í…ŒìŠ¤íŠ¸**: ì„œë²„ ì—°ê²° í™•ì¸
2. **ì‹œìŠ¤í…œ ì„¤ì •**: ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ë° ì„¤ì •
3. **Docker ì„¤ì¹˜**: Docker ë° Docker Compose ì„¤ì¹˜
4. **Nginx ì„¤ì •**: ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ ì„¤ì •
5. **ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬**: Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰

### 3ë‹¨ê³„: SSL ì¸ì¦ì„œ ì„¤ì • (ë„ë©”ì¸ì´ ìˆëŠ” ê²½ìš°)

```bash
# SSL ì¸ì¦ì„œ ì„¤ì •
./infrastructure/scripts/deploy.sh ssl-only
```

#### SSL ì„¤ì • ê³¼ì •
1. **ë„ë©”ì¸ í™•ì¸**: Route 53ì—ì„œ ë„ë©”ì¸ ê´€ë¦¬
2. **ì¸ì¦ì„œ ë°œê¸‰**: Let's Encryptë¥¼ í†µí•œ ë¬´ë£Œ SSL ì¸ì¦ì„œ
3. **Nginx ì„¤ì •**: HTTPS ë¦¬ë‹¤ì´ë ‰íŠ¸ ë° SSL ì„¤ì •

### 4ë‹¨ê³„: í—¬ìŠ¤ ì²´í¬

```bash
# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
curl http://your-server-ip/health
curl http://your-server-ip:8080/actuator/health
curl http://your-server-ip:8001/health
```

## ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ìœ ì§€ë³´ìˆ˜

### 1. ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§

#### ìë™ ëª¨ë‹ˆí„°ë§
- **Cron ì‘ì—…**: 5ë¶„ë§ˆë‹¤ ì‹œìŠ¤í…œ ìƒíƒœ ì²´í¬
- **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: ì• í”Œë¦¬ì¼€ì´ì…˜ ë° ì‹œìŠ¤í…œ ë¡œê·¸ ì¶”ì 
- **ë¦¬ì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§**: CPU, ë©”ëª¨ë¦¬, ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰ ì²´í¬

#### ìˆ˜ë™ ëª¨ë‹ˆí„°ë§
```bash
# ì„œë²„ ì ‘ì†
ssh -i ~/.ssh/lifebit-key.pem ubuntu@your-server-ip

# ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
/home/ubuntu/monitor.sh

# Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ
docker ps

# ë¡œê·¸ í™•ì¸
docker logs lifebit_core_api
docker logs lifebit_ai_api
docker logs lifebit_frontend
```

### 2. ë°±ì—… ê´€ë¦¬

#### ìë™ ë°±ì—…
- **ì¼ì¼ ë°±ì—…**: ë§¤ì¼ ìƒˆë²½ 2ì‹œ ìë™ ë°±ì—…
- **ë³´ê´€ ê¸°ê°„**: 7ì¼ê°„ ë°±ì—… ë³´ê´€
- **ë°±ì—… ë‚´ìš©**: ë°ì´í„°ë² ì´ìŠ¤, ì• í”Œë¦¬ì¼€ì´ì…˜ íŒŒì¼, ì„¤ì • íŒŒì¼

#### ìˆ˜ë™ ë°±ì—…
```bash
# ì„œë²„ì—ì„œ ë°±ì—… ì‹¤í–‰
/opt/lifebit/backup.sh manual_backup_$(date +%Y%m%d_%H%M%S)

# ë°±ì—… ëª©ë¡ í™•ì¸
ls -la /opt/lifebit/backups/
```

### 3. ë¡œê·¸ ê´€ë¦¬

#### ë¡œê·¸ ì •ë¦¬
- **ìë™ ì •ë¦¬**: ë§¤ì¼ ìƒˆë²½ 3ì‹œ ë¡œê·¸ ì •ë¦¬
- **ë³´ê´€ ê¸°ê°„**: 30ì¼ê°„ ë¡œê·¸ ë³´ê´€
- **ì••ì¶•**: 100MB ì´ìƒ ë¡œê·¸ íŒŒì¼ ìë™ ì••ì¶•

#### ë¡œê·¸ í™•ì¸
```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸
tail -f /var/log/lifebit/backup.log
tail -f /var/log/lifebit/health.log

# Nginx ë¡œê·¸
tail -f /var/log/nginx/lifebit_access.log
tail -f /var/log/nginx/lifebit_error.log

# Docker ë¡œê·¸
docker logs -f lifebit_core_api
```

## ğŸ”§ ë¬¸ì œ í•´ê²°

### 1. ì¼ë°˜ì ì¸ ë¬¸ì œë“¤

#### ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì§€ ì•ŠëŠ” ê²½ìš°
```bash
# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps -a

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker restart lifebit_core_api
docker restart lifebit_ai_api
docker restart lifebit_frontend

# ë¡œê·¸ í™•ì¸
docker logs lifebit_core_api
```

#### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨
```bash
# PostgreSQL ìƒíƒœ í™•ì¸
docker exec lifebit_postgres_prod pg_isready -U lifebit_user -d lifebit_db

# ë°ì´í„°ë² ì´ìŠ¤ ì¬ì‹œì‘
docker restart lifebit_postgres_prod

# ì—°ê²° í…ŒìŠ¤íŠ¸
docker exec lifebit_postgres_prod psql -U lifebit_user -d lifebit_db -c "SELECT 1;"
```

#### ë©”ëª¨ë¦¬ ë¶€ì¡±
```bash
# ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í™•ì¸
free -h

# ìŠ¤ì™‘ íŒŒì¼ í™•ì¸
swapon --show

# ë¶ˆí•„ìš”í•œ ì»¨í…Œì´ë„ˆ ì •ë¦¬
docker system prune -f
```

### 2. ë¡¤ë°± ì ˆì°¨

#### ìë™ ë¡¤ë°±
```bash
# ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
./infrastructure/scripts/rollback.sh

# íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
./infrastructure/scripts/rollback.sh 20241201_143022
```

#### ìˆ˜ë™ ë¡¤ë°±
```bash
# ì„œë²„ ì ‘ì†
ssh -i ~/.ssh/lifebit-key.pem ubuntu@your-server-ip

# ì»¨í…Œì´ë„ˆ ì¤‘ì§€
cd /opt/lifebit
docker-compose -f docker-compose.prod.yml down

# ì´ì „ ì´ë¯¸ì§€ë¡œ ë³µì›
docker image tag lifebit_frontend:previous lifebit_frontend:latest

# ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose -f docker-compose.prod.yml up -d
```

### 3. ë””ë²„ê¹… ë„êµ¬

#### ì‹œìŠ¤í…œ ì§„ë‹¨
```bash
# ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸
htop
df -h
free -h

# ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
netstat -tulpn
ping 8.8.8.8

# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
systemctl status nginx
systemctl status docker
```

#### ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ë‹¨
```bash
# API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
curl -v http://localhost:8080/actuator/health
curl -v http://localhost:8001/health

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
docker exec lifebit_postgres_prod psql -U lifebit_user -d lifebit_db -c "SELECT version();"
```

## ğŸ’° ë¹„ìš© ìµœì í™”

### 1. ì¸ìŠ¤í„´ìŠ¤ ìµœì í™”

#### ì¸ìŠ¤í„´ìŠ¤ íƒ€ì… ì„ íƒ
- **t3.medium**: 2 vCPU, 4GB RAM (ì›” ì•½ $30)
- **t3.small**: 2 vCPU, 2GB RAM (ì›” ì•½ $15) - ê°œë°œìš©
- **ìŠ¤íŒŸ ì¸ìŠ¤í„´ìŠ¤**: 50-70% ì ˆì•½ ê°€ëŠ¥

#### ìŠ¤í† ë¦¬ì§€ ìµœì í™”
- **EBS gp3**: gp2 ëŒ€ë¹„ 20% ì ˆì•½
- **í•„ìš”í•œ ìµœì†Œ ìš©ëŸ‰**: 20GB (ê¸°ë³¸ ì„¤ì •)
- **ìŠ¤ëƒ…ìƒ· ê´€ë¦¬**: ë¶ˆí•„ìš”í•œ ìŠ¤ëƒ…ìƒ· ì‚­ì œ

### 2. ë„¤íŠ¸ì›Œí¬ ìµœì í™”

#### ë°ì´í„° ì „ì†¡ ìµœì†Œí™”
- **ë‹¨ì¼ AZ ì‚¬ìš©**: ë°ì´í„° ì „ì†¡ ë¹„ìš© ì ˆì•½
- **CDN ì‚¬ìš©**: ì •ì  íŒŒì¼ ìºì‹± (ì„ íƒì‚¬í•­)
- **ì••ì¶• í™œì„±í™”**: gzip ì••ì¶•ìœ¼ë¡œ ëŒ€ì—­í­ ì ˆì•½

### 3. ëª¨ë‹ˆí„°ë§ ë¹„ìš©

#### CloudWatch ìµœì í™”
- **ê¸°ë³¸ ëª¨ë‹ˆí„°ë§ë§Œ ì‚¬ìš©**: ìƒì„¸ ëª¨ë‹ˆí„°ë§ ë¹„í™œì„±í™”
- **ë¡œê·¸ ë³´ê´€ ê¸°ê°„**: 30ì¼ë¡œ ì œí•œ
- **ë©”íŠ¸ë¦­ í•„í„°ë§**: í•„ìš”í•œ ë©”íŠ¸ë¦­ë§Œ ìˆ˜ì§‘

### 4. ì˜ˆìƒ ì›” ë¹„ìš©

#### ê¸°ë³¸ êµ¬ì„± (t3.medium)
- **EC2 ì¸ìŠ¤í„´ìŠ¤**: $30
- **EBS ë³¼ë¥¨**: $2
- **ë°ì´í„° ì „ì†¡**: $1
- **ì´ ì˜ˆìƒ ë¹„ìš©**: $33/ì›”

#### ìµœì í™” êµ¬ì„± (t3.small)
- **EC2 ì¸ìŠ¤í„´ìŠ¤**: $15
- **EBS ë³¼ë¥¨**: $2
- **ë°ì´í„° ì „ì†¡**: $1
- **ì´ ì˜ˆìƒ ë¹„ìš©**: $18/ì›”

## ğŸ“ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°°í¬ ì „ í™•ì¸ì‚¬í•­
- [ ] AWS ê³„ì • ë° ê¶Œí•œ ì„¤ì • ì™„ë£Œ
- [ ] SSH í‚¤í˜ì–´ ìƒì„± ë° ë“±ë¡
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ
- [ ] Terraform ë° Ansible ì„¤ì¹˜ ì™„ë£Œ
- [ ] ë„ë©”ì¸ ì„¤ì • (ì„ íƒì‚¬í•­)
- [ ] ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

### ë°°í¬ ì¤‘ í™•ì¸ì‚¬í•­
- [ ] Terraform ì¸í”„ë¼ ìƒì„± ì„±ê³µ
- [ ] Ansible ì„œë²„ ì„¤ì • ì™„ë£Œ
- [ ] Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- [ ] SSL ì¸ì¦ì„œ ì ìš© í™•ì¸ (ë„ë©”ì¸ ìˆëŠ” ê²½ìš°)

### ë°°í¬ í›„ í™•ì¸ì‚¬í•­
- [ ] ì›¹ì‚¬ì´íŠ¸ ì ‘ì† í™•ì¸
- [ ] API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ ëª¨ë‹ˆí„°ë§ ì„¤ì •
- [ ] ë°±ì—… ìŠ¤ì¼€ì¤„ ì„¤ì •
- [ ] í—¬ìŠ¤ ì²´í¬ ì •ìƒ ì‘ë™ í™•ì¸

## ğŸ†˜ ì§€ì› ë° ì—°ë½ì²˜

### ë¬¸ì œ ë°œìƒ ì‹œ
1. **ë¡œê·¸ í™•ì¸**: `/var/log/lifebit/` ë””ë ‰í† ë¦¬ í™•ì¸
2. **í—¬ìŠ¤ ì²´í¬**: `/opt/lifebit/health-check.sh` ì‹¤í–‰
3. **ë°±ì—… í™•ì¸**: `/opt/lifebit/backup.sh` ì‹¤í–‰
4. **ë¬¸ì„œ ì°¸ì¡°**: ì´ ê°€ì´ë“œ ë° README.md í™•ì¸

### ì¶”ê°€ ì§€ì›
- **í”„ë¡œì íŠ¸ ë¦¬ë”**: [ì´ë¦„]
- **ê¸°ìˆ  ë¬¸ì˜**: [ì´ë©”ì¼]
- **ë¬¸ì„œ**: [ìœ„í‚¤ ë§í¬]

---

**ì£¼ì˜ì‚¬í•­**: ì´ ë°°í¬ ê°€ì´ë“œëŠ” í•™ì› í”„ë¡œì íŠ¸ìš©ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì¶”ê°€ì ì¸ ë³´ì•ˆ ë° ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 