# ë°°í¬ ì‚¬ìš©ì ì„¤ì • ê°€ì´ë“œ

> **ëª©ì **: LifeBit í”„ë¡œì íŠ¸ì˜ ì™„ì „ ë¬´ì¸ ë°°í¬ë¥¼ ìœ„í•´ ì‚¬ìš©ìê°€ ë°˜ë“œì‹œ ì„¤ì •í•´ì•¼ í•˜ëŠ” ì‘ì—…ë“¤ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ“‹ ê°œìš”

ì´ ë¬¸ì„œëŠ” **ì™„ì „í•œ ë¬´ì¸ ë°°í¬/ìš´ì˜**ì„ ìœ„í•´ ì‚¬ëŒì´ **1íšŒì„±ìœ¼ë¡œ ë°˜ë“œì‹œ ìˆ˜í–‰**í•´ì•¼ í•˜ëŠ” ì„¤ì • ì‘ì—…ë“¤ì„ ë‹¨ê³„ë³„ë¡œ ì•ˆë‚´í•©ë‹ˆë‹¤. ëª¨ë“  ì„¤ì • ì™„ë£Œ í›„ì—ëŠ” GitHub í‘¸ì‹œë§Œìœ¼ë¡œ ì „ì²´ ë°°í¬ê°€ ìë™í™”ë©ë‹ˆë‹¤.

---

## ğŸ¯ ì„¤ì • ì™„ë£Œ í›„ ë‹¬ì„± ëª©í‘œ

- âœ… **ì½”ë“œ í‘¸ì‹œ** â†’ **ìë™ í…ŒìŠ¤íŠ¸** â†’ **ìë™ ë°°í¬** â†’ **ìë™ ëª¨ë‹ˆí„°ë§** â†’ **ìë™ ë¡¤ë°±**(í•„ìš”ì‹œ)
- âœ… **24/7 ë¬´ì¸ ìš´ì˜** ê°€ëŠ¥
- âœ… **ì¥ì•  ìë™ ê°ì§€** ë° **ë³µêµ¬**
- âœ… **ë¹„ìš© ìµœì í™”** ìë™ ì ìš©

---

## 1. ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1.1 í•„ìˆ˜ ê³„ì • ë° ì„œë¹„ìŠ¤
- [ ] **AWS ê³„ì •** (ê²°ì œ ì •ë³´ ë“±ë¡ ì™„ë£Œ)
- [ ] **ë„ë©”ì¸** (êµ¬ë§¤ ë˜ëŠ” ë³´ìœ )
- [ ] **GitHub ê³„ì •** (ë¦¬í¬ì§€í† ë¦¬ ê´€ë¦¬ì ê¶Œí•œ)
- [ ] **OpenAI API ê³„ì •** (GPT ì‚¬ìš©ì„ ìœ„í•œ API í‚¤)
- [ ] **ì¹´ì¹´ì˜¤ ê°œë°œì ê³„ì •** (ì†Œì…œ ë¡œê·¸ì¸ìš©)
- [ ] **êµ¬ê¸€ ê°œë°œì ê³„ì •** (ì†Œì…œ ë¡œê·¸ì¸ìš©)

### 1.2 ë¡œì»¬ ê°œë°œ í™˜ê²½
- [ ] **AWS CLI** ì„¤ì¹˜ ë° ì„¤ì •
- [ ] **Terraform** ì„¤ì¹˜ (v1.0+)
- [ ] **Ansible** ì„¤ì¹˜ (v2.9+)
- [ ] **Docker & Docker Compose** ì„¤ì¹˜
- [ ] **Node.js** 18+ ë° **pnpm** ì„¤ì¹˜
- [ ] **Java 21** ì„¤ì¹˜
- [ ] **Python 3.11+** ì„¤ì¹˜

---

## 2. ğŸ” AWS ê³„ì • ë° ê¶Œí•œ ì„¤ì •

### 2.1 AWS IAM ì‚¬ìš©ì ìƒì„±
```bash
# AWS ì½˜ì†”ì—ì„œ IAM ì‚¬ìš©ì ìƒì„±
# ì‚¬ìš©ìëª…: lifebit-deploy-user
# ì•¡ì„¸ìŠ¤ ìœ í˜•: í”„ë¡œê·¸ë˜ë° ë°©ì‹ ì•¡ì„¸ìŠ¤
```

### 2.2 í•„ìš” ê¶Œí•œ ì •ì±… ì—°ê²°
```json
{
  "í•„ìˆ˜ ê¶Œí•œ": [
    "AmazonEC2FullAccess",
    "AmazonRDSFullAccess",
    "AmazonS3FullAccess",
    "AmazonRoute53FullAccess",
    "IAMFullAccess",
    "AmazonVPCFullAccess",
    "ElasticLoadBalancingFullAccess",
    "AmazonECS_FullAccess",
    "CloudWatchFullAccess"
  ]
}
```

### 2.3 AWS CLI ì„¤ì •
```bash
# í„°ë¯¸ë„ì—ì„œ ì‹¤í–‰
aws configure

# ì…ë ¥ ì •ë³´:
# AWS Access Key ID: [IAM ì‚¬ìš©ì ì•¡ì„¸ìŠ¤ í‚¤]
# AWS Secret Access Key: [IAM ì‚¬ìš©ì ì‹œí¬ë¦¿ í‚¤]
# Default region name: ap-northeast-2
# Default output format: json

# ì„¤ì • í™•ì¸
aws sts get-caller-identity
```

### 2.4 SSH í‚¤í˜ì–´ ìƒì„±
```bash
# AWS ì½˜ì†” â†’ EC2 â†’ í‚¤ í˜ì–´
# í‚¤ í˜ì–´ ì´ë¦„: lifebit-keypair
# í‚¤ í˜ì–´ ìœ í˜•: RSA
# í”„ë¼ì´ë¹— í‚¤ íŒŒì¼ í˜•ì‹: .pem

# ë‹¤ìš´ë¡œë“œí•œ í‚¤ íŒŒì¼ ê¶Œí•œ ì„¤ì •
chmod 400 ~/.ssh/lifebit-keypair.pem
```

---

## 3. ğŸŒ ë„ë©”ì¸ ë° DNS ì„¤ì •

### 3.1 ë„ë©”ì¸ êµ¬ë§¤ (ì„ íƒì‚¬í•­)
```bash
# ì¶”ì²œ ë„ë©”ì¸ ë“±ë¡ì—…ì²´:
# - AWS Route 53
# - ê°€ë¹„ì•„
# - í›„ì´ì¦ˆ
# - Cloudflare

# ì˜ˆì‹œ ë„ë©”ì¸: your-project.com
```

### 3.2 Route 53 í˜¸ìŠ¤íŒ… ì˜ì—­ ìƒì„±
```bash
# AWS ì½˜ì†” â†’ Route 53 â†’ í˜¸ìŠ¤íŒ… ì˜ì—­ ìƒì„±
# ë„ë©”ì¸ ì´ë¦„: your-project.com
# ìœ í˜•: í¼ë¸”ë¦­ í˜¸ìŠ¤íŒ… ì˜ì—­

# ë„¤ì„ì„œë²„ ì •ë³´ë¥¼ ë„ë©”ì¸ ë“±ë¡ì—…ì²´ì— ì„¤ì •
```

### 3.3 DNS ë ˆì½”ë“œ ì¤€ë¹„ (ë°°í¬ í›„ ìë™ ì„¤ì •ë¨)
```bash
# ë‹¤ìŒ ë ˆì½”ë“œë“¤ì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤:
# A ë ˆì½”ë“œ: your-project.com â†’ EC2 ì¸ìŠ¤í„´ìŠ¤ IP
# CNAME: api.your-project.com â†’ your-project.com
# CNAME: www.your-project.com â†’ your-project.com
```

---

## 4. ğŸ”‘ í™˜ê²½ ë³€ìˆ˜ ë° ë¹„ë°€ ì •ë³´ ì„¤ì •

### 4.1 ë£¨íŠ¸ .env íŒŒì¼ ìƒì„±
```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— .env íŒŒì¼ ìƒì„±
cp .env.example .env
```

```env
# .env íŒŒì¼ ë‚´ìš©
# AWS ì„¤ì •
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_REGION=ap-northeast-2
AWS_ACCOUNT_ID=123456789012

# ë„ë©”ì¸ ì„¤ì •
DOMAIN_NAME=your-project.com
SUBDOMAIN_API=api.your-project.com
SUBDOMAIN_WWW=www.your-project.com

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
DB_NAME=lifebit_db
DB_USER=lifebit_user
DB_PASSWORD=your-secure-password-here
DB_HOST=localhost
DB_PORT=5432

# OpenAI API
OPENAI_API_KEY=sk-...

# ì†Œì…œ ë¡œê·¸ì¸
KAKAO_CLIENT_ID=your-kakao-client-id
KAKAO_CLIENT_SECRET=your-kakao-client-secret
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# JWT ì„¤ì •
JWT_SECRET=your-jwt-secret-key-here
JWT_EXPIRATION=86400

# ê¸°íƒ€ ì„¤ì •
ENVIRONMENT=production
LOG_LEVEL=info
```

### 4.2 ê° ì„œë¹„ìŠ¤ë³„ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# AI API í™˜ê²½ ë³€ìˆ˜
cp apps/ai-api-fastapi/.env.example apps/ai-api-fastapi/.env

# Frontend í™˜ê²½ ë³€ìˆ˜
cp apps/frontend-vite/.env.example apps/frontend-vite/.env
```

### 4.3 GitHub Secrets ì„¤ì •
```bash
# GitHub Repository â†’ Settings â†’ Secrets and variables â†’ Actions
# ë‹¤ìŒ ì‹œí¬ë¦¿ë“¤ì„ ì¶”ê°€:

AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_REGION=ap-northeast-2
DOMAIN_NAME=your-project.com
DB_PASSWORD=your-secure-password
OPENAI_API_KEY=sk-...
KAKAO_CLIENT_ID=your-kakao-client-id
KAKAO_CLIENT_SECRET=your-kakao-client-secret
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
JWT_SECRET=your-jwt-secret-key
```

---

## 5. ğŸ—ï¸ ì¸í”„ë¼ ì½”ë“œ ìƒì„±

### 5.1 Terraform ì½”ë“œ ìƒì„±
```bash
# infrastructure/terraform ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p infrastructure/terraform
```

**infrastructure/terraform/main.tf**
```hcl
terraform {
  required_version = ">= 1.0"
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}

provider "aws" {
  region = var.aws_region
}

# VPC ìƒì„±
resource "aws_vpc" "lifebit_vpc" {
  cidr_block           = "10.0.0.0/16"
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name    = "lifebit-vpc"
    Project = "LifeBit"
  }
}

# ì¸í„°ë„· ê²Œì´íŠ¸ì›¨ì´
resource "aws_internet_gateway" "lifebit_igw" {
  vpc_id = aws_vpc.lifebit_vpc.id

  tags = {
    Name    = "lifebit-igw"
    Project = "LifeBit"
  }
}

# í¼ë¸”ë¦­ ì„œë¸Œë„·
resource "aws_subnet" "lifebit_public_subnet" {
  vpc_id                  = aws_vpc.lifebit_vpc.id
  cidr_block              = "10.0.1.0/24"
  availability_zone       = "${var.aws_region}a"
  map_public_ip_on_launch = true

  tags = {
    Name    = "lifebit-public-subnet"
    Project = "LifeBit"
  }
}

# ë¼ìš°íŒ… í…Œì´ë¸”
resource "aws_route_table" "lifebit_public_rt" {
  vpc_id = aws_vpc.lifebit_vpc.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.lifebit_igw.id
  }

  tags = {
    Name    = "lifebit-public-rt"
    Project = "LifeBit"
  }
}

resource "aws_route_table_association" "lifebit_public_rta" {
  subnet_id      = aws_subnet.lifebit_public_subnet.id
  route_table_id = aws_route_table.lifebit_public_rt.id
}

# ë³´ì•ˆ ê·¸ë£¹
resource "aws_security_group" "lifebit_sg" {
  name        = "lifebit-security-group"
  description = "Security group for LifeBit application"
  vpc_id      = aws_vpc.lifebit_vpc.id

  # SSH
  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # HTTP
  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # HTTPS
  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  # Application ports
  ingress {
    from_port   = 8080
    to_port     = 8080
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }

  ingress {
    from_port   = 8001
    to_port     = 8001
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name    = "lifebit-sg"
    Project = "LifeBit"
  }
}

# EC2 ì¸ìŠ¤í„´ìŠ¤
resource "aws_instance" "lifebit_server" {
  ami                    = "ami-0c2d3e23c4f7c8f8c" # Amazon Linux 2023
  instance_type          = "t3.medium"
  key_name               = var.key_pair_name
  vpc_security_group_ids = [aws_security_group.lifebit_sg.id]
  subnet_id              = aws_subnet.lifebit_public_subnet.id

  root_block_device {
    volume_type = "gp3"
    volume_size = 20
    encrypted   = true
  }

  user_data = file("${path.module}/user-data.sh")

  tags = {
    Name    = "lifebit-server"
    Project = "LifeBit"
  }
}

# Elastic IP
resource "aws_eip" "lifebit_eip" {
  instance = aws_instance.lifebit_server.id
  domain   = "vpc"

  tags = {
    Name    = "lifebit-eip"
    Project = "LifeBit"
  }
}
```

**infrastructure/terraform/variables.tf**
```hcl
variable "aws_region" {
  description = "AWS region"
  type        = string
  default     = "ap-northeast-2"
}

variable "domain_name" {
  description = "Domain name for the application"
  type        = string
}

variable "key_pair_name" {
  description = "AWS Key Pair name"
  type        = string
  default     = "lifebit-keypair"
}

variable "db_password" {
  description = "Database password"
  type        = string
  sensitive   = true
}
```

**infrastructure/terraform/outputs.tf**
```hcl
output "instance_ip" {
  description = "Public IP address of the instance"
  value       = aws_eip.lifebit_eip.public_ip
}

output "instance_dns" {
  description = "Public DNS name of the instance"
  value       = aws_instance.lifebit_server.public_dns
}

output "vpc_id" {
  description = "VPC ID"
  value       = aws_vpc.lifebit_vpc.id
}
```

**infrastructure/terraform/user-data.sh**
```bash
#!/bin/bash
yum update -y
yum install -y docker git

# Docker ì‹œì‘
systemctl start docker
systemctl enable docker
usermod -a -G docker ec2-user

# Docker Compose ì„¤ì¹˜
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p /opt/lifebit
chown ec2-user:ec2-user /opt/lifebit
```

### 5.2 Ansible í”Œë ˆì´ë¶ ìƒì„±
```bash
# infrastructure/ansible ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p infrastructure/ansible/{inventory,group_vars,roles/{common,docker,nginx,postgresql,ssl,deploy}/tasks}
```

**infrastructure/ansible/inventory/hosts.yml**
```yaml
all:
  hosts:
    lifebit_server:
      ansible_host: "{{ server_ip }}"
      ansible_user: ec2-user
      ansible_ssh_private_key_file: ~/.ssh/lifebit-keypair.pem
  vars:
    ansible_python_interpreter: /usr/bin/python3
```

**infrastructure/ansible/group_vars/all.yml**
```yaml
# í”„ë¡œì íŠ¸ ì„¤ì •
project_name: lifebit
project_dir: /opt/lifebit
app_user: ec2-user

# ë„ë©”ì¸ ì„¤ì •
domain_name: "{{ lookup('env', 'DOMAIN_NAME') }}"
api_subdomain: "api.{{ domain_name }}"

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
db_name: "{{ lookup('env', 'DB_NAME') }}"
db_user: "{{ lookup('env', 'DB_USER') }}"
db_password: "{{ lookup('env', 'DB_PASSWORD') }}"

# SSL ì„¤ì •
ssl_email: "admin@{{ domain_name }}"
```

**infrastructure/ansible/playbook.yml**
```yaml
---
- name: Deploy LifeBit Application
  hosts: all
  become: yes
  roles:
    - common
    - docker
    - postgresql
    - nginx
    - ssl
    - deploy
```

### 5.3 ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
```bash
mkdir -p infrastructure/scripts
```

**infrastructure/scripts/deploy.sh**
```bash
#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(dirname "$(dirname "$SCRIPT_DIR")")"
TERRAFORM_DIR="$ROOT_DIR/infrastructure/terraform"
ANSIBLE_DIR="$ROOT_DIR/infrastructure/ansible"

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() { echo -e "${GREEN}[INFO]${NC} $1"; }
log_warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
if [[ -f "$ROOT_DIR/.env" ]]; then
    source "$ROOT_DIR/.env"
    log_info "í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ ì™„ë£Œ"
else
    log_error ".env íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    exit 1
fi

# Terraform ë°°í¬
deploy_terraform() {
    log_info "Terraform ì¸í”„ë¼ ë°°í¬ ì‹œì‘..."
    cd "$TERRAFORM_DIR"
    
    terraform init
    terraform plan -var="domain_name=$DOMAIN_NAME" -var="db_password=$DB_PASSWORD"
    terraform apply -var="domain_name=$DOMAIN_NAME" -var="db_password=$DB_PASSWORD" -auto-approve
    
    # ì¸ìŠ¤í„´ìŠ¤ IP ì¶”ì¶œ
    export SERVER_IP=$(terraform output -raw instance_ip)
    log_info "ì¸ìŠ¤í„´ìŠ¤ IP: $SERVER_IP"
    
    cd "$ROOT_DIR"
}

# Ansible ë°°í¬
deploy_ansible() {
    log_info "Ansible ì„œë²„ ì„¤ì • ì‹œì‘..."
    cd "$ANSIBLE_DIR"
    
    # ì¸ë²¤í† ë¦¬ íŒŒì¼ì— IP ì£¼ì…
    sed -i "s/{{ server_ip }}/$SERVER_IP/g" inventory/hosts.yml
    
    # SSH ì—°ê²° ëŒ€ê¸°
    log_info "SSH ì—°ê²° ëŒ€ê¸° ì¤‘..."
    while ! ssh -o ConnectTimeout=5 -o StrictHostKeyChecking=no -i ~/.ssh/lifebit-keypair.pem ec2-user@$SERVER_IP 'echo "SSH ì—°ê²° ì„±ê³µ"' 2>/dev/null; do
        echo "SSH ì—°ê²° ëŒ€ê¸° ì¤‘..."
        sleep 10
    done
    
    # Ansible í”Œë ˆì´ë¶ ì‹¤í–‰
    ansible-playbook -i inventory/hosts.yml playbook.yml
    
    cd "$ROOT_DIR"
}

# í—¬ìŠ¤ ì²´í¬
health_check() {
    log_info "ì„œë¹„ìŠ¤ í—¬ìŠ¤ ì²´í¬ ì‹œì‘..."
    
    # ìµœëŒ€ 5ë¶„ ëŒ€ê¸°
    for i in {1..30}; do
        if curl -f "http://$DOMAIN_NAME" >/dev/null 2>&1; then
            log_info "âœ… ì›¹ì‚¬ì´íŠ¸ ì •ìƒ ì‘ë™ í™•ì¸"
            break
        fi
        
        if [[ $i -eq 30 ]]; then
            log_error "âŒ í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨"
            exit 1
        fi
        
        echo "í—¬ìŠ¤ ì²´í¬ ëŒ€ê¸° ì¤‘... ($i/30)"
        sleep 10
    done
}

# ë©”ì¸ ì‹¤í–‰
main() {
    log_info "ğŸš€ LifeBit ìë™ ë°°í¬ ì‹œì‘"
    
    case "${1:-all}" in
        terraform-only)
            deploy_terraform
            ;;
        ansible-only)
            if [[ -z "$SERVER_IP" ]]; then
                SERVER_IP=$(cd "$TERRAFORM_DIR" && terraform output -raw instance_ip)
            fi
            deploy_ansible
            ;;
        all)
            deploy_terraform
            deploy_ansible
            health_check
            ;;
        *)
            log_error "ì‚¬ìš©ë²•: $0 [terraform-only|ansible-only|all]"
            exit 1
            ;;
    esac
    
    log_info "ğŸ‰ ë°°í¬ ì™„ë£Œ!"
    log_info "ğŸŒ ì›¹ì‚¬ì´íŠ¸: https://$DOMAIN_NAME"
    log_info "ğŸ“Š API: https://api.$DOMAIN_NAME"
}

main "$@"
```

**infrastructure/scripts/rollback.sh**
```bash
#!/bin/bash
set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(dirname "$(dirname "$SCRIPT_DIR")")"

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() { echo -e "${GREEN}[INFO]${NC} $1"; }
log_warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
if [[ -f "$ROOT_DIR/.env" ]]; then
    source "$ROOT_DIR/.env"
else
    log_error ".env íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    exit 1
fi

# ì„œë²„ IP ê°€ì ¸ì˜¤ê¸°
get_server_ip() {
    cd "$ROOT_DIR/infrastructure/terraform"
    SERVER_IP=$(terraform output -raw instance_ip 2>/dev/null || echo "")
    
    if [[ -z "$SERVER_IP" ]]; then
        log_error "ì„œë²„ IPë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        exit 1
    fi
    
    log_info "ì„œë²„ IP: $SERVER_IP"
}

# ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
rollback_services() {
    log_info "ì„œë¹„ìŠ¤ ë¡¤ë°± ì‹œì‘..."
    
    ssh -i ~/.ssh/lifebit-keypair.pem ec2-user@$SERVER_IP << 'EOF'
        cd /opt/lifebit
        
        # í˜„ì¬ ì»¨í…Œì´ë„ˆ ì¤‘ì§€
        docker-compose down
        
        # ì´ì „ ì´ë¯¸ì§€ë¡œ íƒœê·¸ ë³€ê²½
        docker tag lifebit_frontend:current lifebit_frontend:rollback
        docker tag lifebit_frontend:previous lifebit_frontend:current
        docker tag lifebit_core_api:current lifebit_core_api:rollback
        docker tag lifebit_core_api:previous lifebit_core_api:current
        docker tag lifebit_ai_api:current lifebit_ai_api:rollback
        docker tag lifebit_ai_api:previous lifebit_ai_api:current
        
        # ì„œë¹„ìŠ¤ ì¬ì‹œì‘
        docker-compose up -d
        
        echo "ë¡¤ë°± ì™„ë£Œ"
EOF
}

# í—¬ìŠ¤ ì²´í¬
health_check() {
    log_info "ë¡¤ë°± í›„ í—¬ìŠ¤ ì²´í¬..."
    
    sleep 30
    
    if curl -f "http://$DOMAIN_NAME" >/dev/null 2>&1; then
        log_info "âœ… ë¡¤ë°± ì„±ê³µ - ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™"
    else
        log_error "âŒ ë¡¤ë°± í›„ì—ë„ ì„œë¹„ìŠ¤ ë¬¸ì œ ë°œìƒ"
        exit 1
    fi
}

# ë©”ì¸ ì‹¤í–‰
main() {
    log_info "ğŸ”„ LifeBit ì„œë¹„ìŠ¤ ë¡¤ë°± ì‹œì‘"
    
    get_server_ip
    rollback_services
    health_check
    
    log_info "ğŸ‰ ë¡¤ë°± ì™„ë£Œ!"
}

main "$@"
```

**infrastructure/scripts/health-check.sh**
```bash
#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(dirname "$(dirname "$SCRIPT_DIR")")"

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

log_info() { echo -e "${GREEN}[INFO]${NC} $1"; }
log_warn() { echo -e "${YELLOW}[WARN]${NC} $1"; }
log_error() { echo -e "${RED}[ERROR]${NC} $1"; }

# í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
if [[ -f "$ROOT_DIR/.env" ]]; then
    source "$ROOT_DIR/.env"
else
    log_error ".env íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
    exit 1
fi

# ì›¹ì‚¬ì´íŠ¸ í—¬ìŠ¤ ì²´í¬
check_website() {
    if curl -f -s "https://$DOMAIN_NAME" >/dev/null; then
        log_info "âœ… ì›¹ì‚¬ì´íŠ¸ ì •ìƒ"
        return 0
    else
        log_error "âŒ ì›¹ì‚¬ì´íŠ¸ ì ‘ì† ë¶ˆê°€"
        return 1
    fi
}

# API í—¬ìŠ¤ ì²´í¬
check_api() {
    if curl -f -s "https://api.$DOMAIN_NAME/actuator/health" >/dev/null; then
        log_info "âœ… Core API ì •ìƒ"
        api_status=0
    else
        log_error "âŒ Core API ì ‘ì† ë¶ˆê°€"
        api_status=1
    fi
    
    if curl -f -s "https://api.$DOMAIN_NAME/health" >/dev/null; then
        log_info "âœ… AI API ì •ìƒ"
        ai_status=0
    else
        log_error "âŒ AI API ì ‘ì† ë¶ˆê°€"
        ai_status=1
    fi
    
    return $((api_status + ai_status))
}

# ë°ì´í„°ë² ì´ìŠ¤ í—¬ìŠ¤ ì²´í¬
check_database() {
    cd "$ROOT_DIR/infrastructure/terraform"
    SERVER_IP=$(terraform output -raw instance_ip 2>/dev/null || echo "")
    
    if [[ -z "$SERVER_IP" ]]; then
        log_error "ì„œë²„ IPë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
        return 1
    fi
    
    db_check=$(ssh -i ~/.ssh/lifebit-keypair.pem ec2-user@$SERVER_IP \
        "docker exec lifebit_postgres pg_isready -U $DB_USER -d $DB_NAME" 2>/dev/null || echo "failed")
    
    if [[ "$db_check" == *"accepting connections"* ]]; then
        log_info "âœ… ë°ì´í„°ë² ì´ìŠ¤ ì •ìƒ"
        return 0
    else
        log_error "âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë¶ˆê°€"
        return 1
    fi
}

# ì „ì²´ í—¬ìŠ¤ ì²´í¬
main() {
    log_info "ğŸ” LifeBit ì„œë¹„ìŠ¤ í—¬ìŠ¤ ì²´í¬ ì‹œì‘"
    
    failed=0
    
    check_website || ((failed++))
    check_api || ((failed++))
    check_database || ((failed++))
    
    if [[ $failed -eq 0 ]]; then
        log_info "ğŸ‰ ëª¨ë“  ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë™"
        exit 0
    else
        log_error "âš ï¸ $failed ê°œ ì„œë¹„ìŠ¤ì— ë¬¸ì œ ë°œìƒ"
        exit 1
    fi
}

main "$@"
```

---

## 6. ğŸ”§ CI/CD íŒŒì´í”„ë¼ì¸ ì„¤ì •

### 6.1 GitHub Actions ì›Œí¬í”Œë¡œìš° ìƒì„±
```bash
mkdir -p .github/workflows
```

**.github/workflows/deploy.yml**
```yaml
name: Deploy LifeBit

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  AWS_REGION: ap-northeast-2

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'pnpm'
    
    - name: Install dependencies
      run: pnpm install
    
    - name: Run tests
      run: pnpm test
  
  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v4
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: ${{ env.AWS_REGION }}
    
    - name: Setup Terraform
      uses: hashicorp/setup-terraform@v3
      with:
        terraform_version: 1.6.0
    
    - name: Setup Ansible
      run: |
        pip install ansible
        ansible-galaxy install -r requirements.yml
    
    - name: Deploy Infrastructure
      run: |
        cd infrastructure/terraform
        terraform init
        terraform apply -auto-approve \
          -var="domain_name=${{ secrets.DOMAIN_NAME }}" \
          -var="db_password=${{ secrets.DB_PASSWORD }}"
    
    - name: Deploy Application
      run: |
        export SERVER_IP=$(cd infrastructure/terraform && terraform output -raw instance_ip)
        cd infrastructure/ansible
        sed -i "s/{{ server_ip }}/$SERVER_IP/g" inventory/hosts.yml
        ansible-playbook -i inventory/hosts.yml playbook.yml
    
    - name: Health Check
      run: |
        sleep 60
        curl -f "https://${{ secrets.DOMAIN_NAME }}" || exit 1
        curl -f "https://api.${{ secrets.DOMAIN_NAME }}/actuator/health" || exit 1
```

---

## 7. ğŸ“Š ëª¨ë‹ˆí„°ë§ ë° ì•Œë¦¼ ì„¤ì •

### 7.1 ëª¨ë‹ˆí„°ë§ ì„¤ì • íŒŒì¼ ìƒì„±
```bash
mkdir -p monitoring/{prometheus,grafana/dashboards,loki}
```

**monitoring/prometheus/prometheus.yml**
```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'lifebit-core-api'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: '/actuator/prometheus'
  
  - job_name: 'lifebit-ai-api'
    static_configs:
      - targets: ['localhost:8001']
    metrics_path: '/metrics'
  
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['localhost:9100']
```

### 7.2 ì•Œë¦¼ ì„¤ì • (Slack ì›¹í›…)
```bash
# Slack ì•± ìƒì„± ë° ì›¹í›… URL íšë“
# https://api.slack.com/apps â†’ Create New App
# Incoming Webhooks â†’ Activate â†’ Add New Webhook
```

---

## 8. ğŸ”’ ë³´ì•ˆ ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

### 8.1 JWT ì‹œí¬ë¦¿ í‚¤ ìƒì„±
```bash
# ê°•ë ¥í•œ JWT ì‹œí¬ë¦¿ ìƒì„±
openssl rand -base64 64

# ìƒì„±ëœ í‚¤ë¥¼ .env íŒŒì¼ì˜ JWT_SECRETì— ì¶”ê°€
```

### 8.2 ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ ìƒì„±
```bash
# ê°•ë ¥í•œ DB ë¹„ë°€ë²ˆí˜¸ ìƒì„±
openssl rand -base64 32

# ìƒì„±ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ .env íŒŒì¼ì˜ DB_PASSWORDì— ì¶”ê°€
```

### 8.3 SSH í‚¤ ë³´ì•ˆ ì„¤ì •
```bash
# SSH í‚¤ íŒŒì¼ ê¶Œí•œ ì„¤ì •
chmod 400 ~/.ssh/lifebit-keypair.pem

# SSH ì„¤ì • íŒŒì¼ì— ì¶”ê°€ (ì„ íƒì‚¬í•­)
cat >> ~/.ssh/config << EOF
Host lifebit-server
    HostName your-server-ip
    User ec2-user
    IdentityFile ~/.ssh/lifebit-keypair.pem
    StrictHostKeyChecking no
EOF
```

---

## 9. ğŸ§ª ì†Œì…œ ë¡œê·¸ì¸ ì„¤ì •

### 9.1 ì¹´ì¹´ì˜¤ ê°œë°œì ê³„ì • ì„¤ì •
```bash
# 1. https://developers.kakao.com ì ‘ì†
# 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€í•˜ê¸°
# 3. ì•± í‚¤ â†’ REST API í‚¤ ë³µì‚¬
# 4. í”Œë«í¼ ì„¤ì • â†’ Web â†’ ë„ë©”ì¸ ë“±ë¡: https://your-domain.com
# 5. ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ â†’ í™œì„±í™” ì„¤ì •
# 6. Redirect URI ì„¤ì •: https://your-domain.com/auth/kakao/callback
```

### 9.2 êµ¬ê¸€ ê°œë°œì ê³„ì • ì„¤ì •
```bash
# 1. https://console.developers.google.com ì ‘ì†
# 2. ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
# 3. API ë° ì„œë¹„ìŠ¤ â†’ ì‚¬ìš©ì ì¸ì¦ ì •ë³´
# 4. OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ ID ìƒì„±
# 5. ìŠ¹ì¸ëœ ë¦¬ë””ë ‰ì…˜ URI: https://your-domain.com/auth/google/callback
# 6. í´ë¼ì´ì–¸íŠ¸ ID ë° ì‹œí¬ë¦¿ ë³µì‚¬
```

---

## 10. âœ… ìµœì¢… ë°°í¬ ì‹¤í–‰

### 10.1 ì„¤ì • ê²€ì¦
```bash
# ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ í™•ì¸
source .env
echo "AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID:0:10}..."
echo "DOMAIN_NAME: $DOMAIN_NAME"
echo "DB_PASSWORD: ${DB_PASSWORD:0:5}..."
echo "OPENAI_API_KEY: ${OPENAI_API_KEY:0:10}..."

# AWS ì—°ê²° í™•ì¸
aws sts get-caller-identity

# Terraform ì„¤ì • í™•ì¸
cd infrastructure/terraform
terraform validate
```

### 10.2 ì²« ë°°í¬ ì‹¤í–‰
```bash
# ì „ì²´ ë°°í¬ ì‹¤í–‰
chmod +x infrastructure/scripts/*.sh
./infrastructure/scripts/deploy.sh

# ë˜ëŠ” ë‹¨ê³„ë³„ ë°°í¬
./infrastructure/scripts/deploy.sh terraform-only
./infrastructure/scripts/deploy.sh ansible-only
```

### 10.3 ë°°í¬ í›„ í™•ì¸
```bash
# í—¬ìŠ¤ ì²´í¬ ì‹¤í–‰
./infrastructure/scripts/health-check.sh

# ìˆ˜ë™ í™•ì¸
curl -f "https://$DOMAIN_NAME"
curl -f "https://api.$DOMAIN_NAME/actuator/health"
```

---

## ğŸ‰ ì™„ë£Œ í›„ ë¬´ì¸ ìš´ì˜

ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ **ì™„ì „ ë¬´ì¸ ìš´ì˜**ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤:

### âœ… ìë™í™”ëœ ì‘ì—…ë“¤
- **ì½”ë“œ í‘¸ì‹œ** â†’ **ìë™ í…ŒìŠ¤íŠ¸** â†’ **ìë™ ë°°í¬**
- **ì„œë¹„ìŠ¤ ì¥ì•  ê°ì§€** â†’ **ìë™ ì¬ì‹œì‘** â†’ **Slack ì•Œë¦¼**
- **SSL ì¸ì¦ì„œ ìë™ ê°±ì‹ ** (Let's Encrypt)
- **ë°ì´í„°ë² ì´ìŠ¤ ìë™ ë°±ì—…** (ì¼ì¼ ìŠ¤ëƒ…ìƒ·)
- **ë¡œê·¸ ìë™ ìˆ˜ì§‘** ë° **ëª¨ë‹ˆí„°ë§**
- **ë¹„ìš© ì•Œë¦¼** (AWS ì˜ˆì‚° ì´ˆê³¼ ì‹œ)

### ğŸ”„ ì •ê¸° ê´€ë¦¬ ì‘ì—… (ì›” 1íšŒ)
- **ë¹„ìš© ë¦¬í¬íŠ¸ ê²€í† **
- **ë³´ì•ˆ ì—…ë°ì´íŠ¸ í™•ì¸**
- **ë°±ì—… ë°ì´í„° ê²€ì¦**
- **ì„±ëŠ¥ ë©”íŠ¸ë¦­ ë¶„ì„**

---

## ğŸ“ ë¬¸ì œ í•´ê²° ë° ì§€ì›

### ì¼ë°˜ì ì¸ ë¬¸ì œë“¤
1. **Terraform ì˜¤ë¥˜**: `terraform destroy` í›„ ì¬ë°°í¬
2. **SSH ì—°ê²° ì‹¤íŒ¨**: ë³´ì•ˆ ê·¸ë£¹ ë° í‚¤í˜ì–´ í™•ì¸
3. **ë„ë©”ì¸ ì—°ê²° ì‹¤íŒ¨**: DNS ì „íŒŒ ëŒ€ê¸° (ìµœëŒ€ 48ì‹œê°„)
4. **SSL ì¸ì¦ì„œ ì˜¤ë¥˜**: Let's Encrypt ì¬ë°œê¸‰

### ê¸´ê¸‰ ìƒí™© ëŒ€ì‘
```bash
# ì„œë¹„ìŠ¤ ë¡¤ë°±
./infrastructure/scripts/rollback.sh

# ì „ì²´ ì¸í”„ë¼ ì‚­ì œ
./aws-cleanup.sh --force

# í—¬ìŠ¤ ì²´í¬
./infrastructure/scripts/health-check.sh
```

---

**ğŸ¯ ì´ ê°€ì´ë“œë¥¼ ì™„ë£Œí•˜ë©´ GitHubì— ì½”ë“œë§Œ í‘¸ì‹œí•´ë„ ì „ì²´ ì„œë¹„ìŠ¤ê°€ ìë™ìœ¼ë¡œ ë°°í¬ë©ë‹ˆë‹¤!**