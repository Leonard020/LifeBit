# LifeBit AWS ë°°í¬ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸](#ë°°í¬-ì „-ì²´í¬ë¦¬ìŠ¤íŠ¸)
2. [ê°œë°œ í™˜ê²½ê³¼ ë°°í¬ í™˜ê²½ì˜ ë¶„ë¦¬](#ê°œë°œ-í™˜ê²½ê³¼-ë°°í¬-í™˜ê²½ì˜-ë¶„ë¦¬)
3. [ë°°í¬ ì ˆì°¨](#ë°°í¬-ì ˆì°¨)
4. [ë°°í¬ í›„ í™•ì¸](#ë°°í¬-í›„-í™•ì¸)
5. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)
6. [ë°°í¬ í™˜ê²½ ì •ë¦¬](#ë°°í¬-í™˜ê²½-ì •ë¦¬)

## ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 1. í•„ìˆ˜ ë„êµ¬ ì„¤ì¹˜ í™•ì¸
- [ ] AWS CLI
- [ ] Terraform
- [ ] Ansible
- [ ] Docker & Docker Compose

### 2. AWS ê³„ì • ì„¤ì •
- [ ] AWS ìê²© ì¦ëª… ì„¤ì • (`aws configure`)
- [ ] EC2, VPC, RDS ê¶Œí•œ í™•ì¸

### 3. ë¡œì»¬ ê°œë°œ í™˜ê²½ í™•ì¸
```bash
# ë°°í¬ ì „ ì²´í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
./scripts/pre-deployment-check.sh

# ë¡œì»¬ ê°œë°œ í™˜ê²½ ì¤‘ì§€ (ì„ íƒì‚¬í•­, í¬íŠ¸ ì¶©ëŒ ë°©ì§€)
docker-compose -f docker-compose.local.yml down
```

## ê°œë°œ í™˜ê²½ê³¼ ë°°í¬ í™˜ê²½ì˜ ë¶„ë¦¬

### í™˜ê²½ë³„ ì„¤ì • ì°¨ì´

| êµ¬ë¶„ | ê°œë°œ í™˜ê²½ | ë°°í¬ í™˜ê²½ |
|------|-----------|-----------|
| Docker Compose | `docker-compose.local.yml` | `docker-compose.prod.yml` |
| ì»¨í…Œì´ë„ˆ ì´ë¦„ | `lifebit_*` | `lifebit_*_prod` |
| ë„¤íŠ¸ì›Œí¬ | `172.20.0.0/16` | `172.21.0.0/16` |
| ë³¼ë¥¨ | `postgres_data` | `postgres_data_prod` |
| í¬íŠ¸ | ë¡œì»¬ í¬íŠ¸ ì‚¬ìš© | EC2 ì¸ìŠ¤í„´ìŠ¤ í¬íŠ¸ |

### í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬

**ê°œë°œ í™˜ê²½ (.env.local)**
```env
# ë¡œì»¬ ê°œë°œìš© ì„¤ì •
DATABASE_URL=postgresql://lifebit_user:lifebit_password@localhost:5432/lifebit_db
VITE_CORE_API_URL=http://localhost:8080
VITE_AI_API_URL=http://localhost:8001
```

**ë°°í¬ í™˜ê²½ (ìë™ ìƒì„±)**
- ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ê°€ ì…ë ¥ë°›ì€ ì •ë³´ë¡œ `.env` íŒŒì¼ ìë™ ìƒì„±
- Ansibleì´ í…œí”Œë¦¿ì„ í†µí•´ í™˜ê²½ì— ë§ê²Œ ì„¤ì •

## ë°°í¬ ì ˆì°¨

### 1. ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
```bash
./scripts/aws-deploy.sh
```

### 2. í™˜ê²½ ë³€ìˆ˜ ì…ë ¥
ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì‹œ ë‹¤ìŒ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤:

#### í•„ìˆ˜ í•­ëª©
- **OpenAI API Key**: AI ì±„íŒ… ê¸°ëŠ¥ìš© (ì—†ìœ¼ë©´ ê¸°ëŠ¥ ë¹„í™œì„±í™”)
- **JWT Secret**: ìë™ ìƒì„± ê°€ëŠ¥
- **PostgreSQL ì„¤ì •**: ê¸°ë³¸ê°’ ì‚¬ìš© ê°€ëŠ¥

#### ì„ íƒ í•­ëª©
- **ë„ë©”ì¸ ì´ë¦„**: ì—†ìœ¼ë©´ EC2 IP ì‚¬ìš©
- **SSL ì¸ì¦ì„œ**: ë„ë©”ì¸ ì‚¬ìš© ì‹œ ì„¤ì •
- **ì†Œì…œ ë¡œê·¸ì¸**: Google/Kakao Client ID

### 3. ë°°í¬ í”„ë¡œì„¸ìŠ¤
1. **ì¸í”„ë¼ ìƒì„±** (Terraform)
   - EC2 ì¸ìŠ¤í„´ìŠ¤
   - VPC ë° ë³´ì•ˆ ê·¸ë£¹
   - Elastic IP

2. **ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬** (Ansible)
   - Docker ë° Docker Compose ì„¤ì¹˜
   - ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ì „ì†¡
   - í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
   - ì»¨í…Œì´ë„ˆ ì‹¤í–‰

3. **SSL ì„¤ì •** (ë„ë©”ì¸ ì‚¬ìš© ì‹œ)
   - Let's Encrypt ì¸ì¦ì„œ ë°œê¸‰
   - Nginx HTTPS ì„¤ì •

## ë°°í¬ í›„ í™•ì¸

### 1. ì„œë¹„ìŠ¤ ì ‘ì† í™•ì¸
```bash
# ë°°í¬ ì •ë³´ í™•ì¸
cat .deployment_info

# ì„œë¹„ìŠ¤ URL
í”„ë¡ íŠ¸ì—”ë“œ: http://<EC2_IP>:3000
Core API: http://<EC2_IP>:8080
AI API: http://<EC2_IP>:8001
í†µí•© Nginx: http://<EC2_IP>
```

### 2. ì„œë²„ ìƒíƒœ í™•ì¸
```bash
# SSH ì ‘ì†
ssh -i ~/.ssh/lifebit_key ubuntu@<EC2_IP>

# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps

# ë¡œê·¸ í™•ì¸
docker-compose -f docker-compose.prod.yml logs -f

# í—¬ìŠ¤ì²´í¬
curl http://<EC2_IP>:8080/actuator/health
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ í™•ì¸
```bash
# PostgreSQL ì ‘ì†
docker exec -it lifebit_postgres_prod psql -U lifebit_user -d lifebit_db

# í…Œì´ë¸” í™•ì¸
\dt

# ì‚¬ìš©ì ìˆ˜ í™•ì¸
SELECT COUNT(*) FROM users;
```

## ë¬¸ì œ í•´ê²°

### í¬íŠ¸ ì¶©ëŒ ë¬¸ì œ
```bash
# ë¡œì»¬ ê°œë°œ í™˜ê²½ ì¤‘ì§€
docker-compose -f docker-compose.local.yml down

# ì‚¬ìš© ì¤‘ì¸ í¬íŠ¸ í™•ì¸
lsof -i :8080
lsof -i :8001
lsof -i :3000
```

### ë°°í¬ ì‹¤íŒ¨ ì‹œ
```bash
# Terraform ìƒíƒœ í™•ì¸
cd infrastructure/terraform
terraform show

# Ansible ë¡œê·¸ í™•ì¸
cat /var/log/ansible.log

# EC2 ì¸ìŠ¤í„´ìŠ¤ ì§ì ‘ í™•ì¸
ssh -i ~/.ssh/lifebit_key ubuntu@<EC2_IP>
journalctl -u docker
```

### SSL ì¸ì¦ì„œ ë¬¸ì œ
```bash
# í…ŒìŠ¤íŠ¸ ì¸ì¦ì„œì—ì„œ ì‹¤ì œ ì¸ì¦ì„œë¡œ ë³€ê²½
ssh -i ~/.ssh/lifebit_key ubuntu@<EC2_IP>
sudo certbot certonly --standalone -d <ë„ë©”ì¸> --force-renewal
```

## ë°°í¬ í™˜ê²½ ì •ë¦¬

### ì „ì²´ ë¦¬ì†ŒìŠ¤ ì‚­ì œ
```bash
# AWS ë¦¬ì†ŒìŠ¤ ì •ë¦¬
./scripts/aws-destroy.sh

# ë˜ëŠ” Terraform ì§ì ‘ ì‹¤í–‰
cd infrastructure/terraform
terraform destroy
```

### ë¶€ë¶„ ì •ë¦¬
```bash
# ì»¨í…Œì´ë„ˆë§Œ ì¤‘ì§€
ssh -i ~/.ssh/lifebit_key ubuntu@<EC2_IP>
docker-compose -f docker-compose.prod.yml down

# ë³¼ë¥¨ í¬í•¨ ì‚­ì œ
docker-compose -f docker-compose.prod.yml down -v
```

## ì£¼ì˜ì‚¬í•­

1. **ê°œë°œ í™˜ê²½ ë³´í˜¸**
   - ê°œë°œ ì¤‘ì¸ ë°ì´í„°ëŠ” ë³„ë„ ë°±ì—…
   - ë¡œì»¬ `.env` íŒŒì¼ì€ ë°°í¬ì— ì‚¬ìš©ë˜ì§€ ì•ŠìŒ

2. **ë³´ì•ˆ**
   - JWT Secretì€ ì ˆëŒ€ ê³µìœ í•˜ì§€ ì•Šê¸°
   - API í‚¤ëŠ” í™˜ê²½ ë³€ìˆ˜ë¡œë§Œ ê´€ë¦¬
   - í”„ë¡œë•ì…˜ ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ëŠ” ê°•ë ¥í•˜ê²Œ ì„¤ì •

3. **ë¹„ìš© ê´€ë¦¬**
   - ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤ëŠ” ì¦‰ì‹œ ì¢…ë£Œ
   - Elastic IPëŠ” ì—°ê²°ë˜ì§€ ì•Šìœ¼ë©´ ê³¼ê¸ˆë¨
   - ì •ê¸°ì ìœ¼ë¡œ AWS ë¹„ìš© í™•ì¸

4. **ë°±ì—…**
   - í”„ë¡œë•ì…˜ ë°ì´í„°ëŠ” ì •ê¸°ì ìœ¼ë¡œ ë°±ì—…
   - ë°°í¬ ì „ í˜„ì¬ ìƒíƒœ ìŠ¤ëƒ…ìƒ· ìƒì„± ê¶Œì¥

## ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [AWS EC2 ê°€ê²© ì •ì±…](https://aws.amazon.com/ec2/pricing/)
- [Docker Compose ë¬¸ì„œ](https://docs.docker.com/compose/)
- [Terraform AWS Provider](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)
- [Ansible ëª¨ë²” ì‚¬ë¡€](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html) 